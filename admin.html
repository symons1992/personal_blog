<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台管理 - 奥特曼博客</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* 后台管理样式 */
        .admin-login {
            max-width: 400px;
            margin: 5rem auto;
            padding: 2rem;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        .admin-login h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .btn {
            width: 100%;
            padding: 0.75rem;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: #343a40;
            color: white;
            padding: 1rem;
        }
        
        .sidebar h2 {
            margin-bottom: 2rem;
            text-align: center;
            font-size: 1.5rem;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 1rem;
        }
        
        .sidebar-menu a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 0.75rem;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        
        .sidebar-menu a:hover {
            background-color: #495057;
        }
        
        .main-content {
            flex: 1;
            padding: 2rem;
            background-color: #f8f9fa;
        }
        
        .admin-header {
            background-color: white;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border-radius: 8px;
        }
        
        .admin-header h1 {
            margin: 0;
            font-size: 2rem;
            color: #333;
        }
        
        .form-container {
            background-color: white;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            resize: vertical;
            min-height: 150px;
        }
        
        .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .message {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <!-- 登录页面 -->
    <div id="login-container" class="admin-login">
        <h2>后台登录</h2>
        <form id="login-form">
            <div class="form-group">
                <label for="username">用户名</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">密码</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn">登录</button>
            <div id="login-message" class="message" style="display: none;"></div>
        </form>
    </div>

    <!-- 后台管理页面 -->
    <div id="admin-container" class="admin-container" style="display: none;">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <h2>后台管理</h2>
            <ul class="sidebar-menu">
                <li><a href="#" onclick="showPage('dashboard')">仪表盘</a></li>
                <li><a href="#" onclick="showPage('create-post')">发布文章</a></li>
                <li><a href="#" onclick="showPage('posts')">文章列表</a></li>
                <li><a href="#" onclick="logout()">退出登录</a></li>
            </ul>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 头部 -->
            <header class="admin-header">
                <h1 id="page-title">仪表盘</h1>
            </header>

            <!-- 页面内容 -->
            <div id="page-content">
                <!-- 仪表盘 -->
                <div id="dashboard-page" class="form-container">
                    <h2>欢迎使用后台管理系统</h2>
                    <p>这里是博客的后台管理中心，您可以在这里发布和管理文章。</p>
                </div>

                <!-- 发布文章表单 -->
                <div id="create-post-page" class="form-container" style="display: none;">
                    <h2>发布新文章</h2>
                    <form id="post-form">
                        <div class="form-group">
                            <label for="title">标题</label>
                            <input type="text" id="title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="category">分类</label>
                            <input type="text" id="category" name="category" required>
                        </div>
                        <div class="form-group">
                            <label for="author">作者</label>
                            <input type="text" id="author" name="author" required>
                        </div>
                        <div class="form-group">
                            <label for="image">图片URL</label>
                            <input type="text" id="image" name="image">
                        </div>
                        <div class="form-group">
                            <label for="excerpt">摘要</label>
                            <textarea id="excerpt" name="excerpt" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="content">内容</label>
                            <textarea id="content" name="content" required></textarea>
                        </div>
                        <button type="submit" class="btn">发布文章</button>
                        <div id="post-message" class="message" style="display: none;"></div>
                    </form>
                </div>

                <!-- 文章列表 -->
                <div id="posts-page" class="form-container" style="display: none;">
                    <h2>文章列表</h2>
                    <div id="posts-list">
                        <!-- 文章列表将动态生成 -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // 页面加载时检查登录状态
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
        });

        // 检查登录状态
        function checkLoginStatus() {
            if (localStorage.getItem('admin_logged_in')) {
                showAdminPanel();
            }
        }

        // 登录表单提交
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const message = document.getElementById('login-message');
            
            // 调用后端登录API
            fetch('http://localhost:5001/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    localStorage.setItem('admin_logged_in', 'true');
                    localStorage.setItem('admin_user', JSON.stringify(data.data));
                    showAdminPanel();
                } else {
                    message.textContent = data.message || '登录失败';
                    message.className = 'message error';
                    message.style.display = 'block';
                }
            })
            .catch(error => {
                message.textContent = '网络错误：' + error.message;
                message.className = 'message error';
                message.style.display = 'block';
            });
        });

        // 显示管理面板
        function showAdminPanel() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('admin-container').style.display = 'flex';
            showPage('dashboard');
        }

        // 切换页面
        function showPage(pageName) {
            // 隐藏所有页面
            const pages = document.querySelectorAll('#page-content > div');
            pages.forEach(page => {
                page.style.display = 'none';
            });

            // 显示选中的页面
            document.getElementById(`${pageName}-page`).style.display = 'block';
            
            // 更新页面标题
            const titles = {
                'dashboard': '仪表盘',
                'create-post': '发布文章',
                'posts': '文章列表'
            };
            document.getElementById('page-title').textContent = titles[pageName];

            // 如果是文章列表页面，加载文章
            if (pageName === 'posts') {
                loadPosts();
            }
        }

        // 退出登录
        function logout() {
            localStorage.removeItem('admin_logged_in');
            document.getElementById('admin-container').style.display = 'none';
            document.getElementById('login-container').style.display = 'block';
        }

        // 发布文章表单提交
        document.getElementById('post-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const postData = {
                title: formData.get('title'),
                category: formData.get('category'),
                author: formData.get('author'),
                image: formData.get('image') || 'https://via.placeholder.com/600x400/667eea/ffffff?text=Default',
                excerpt: formData.get('excerpt'),
                content: formData.get('content')
            };
            
            fetch('http://localhost:5001/api/posts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(postData)
            })
            .then(response => response.json())
            .then(data => {
                const message = document.getElementById('post-message');
                if (data.success) {
                    message.textContent = '文章发布成功！';
                    message.className = 'message success';
                    this.reset();
                } else {
                    message.textContent = '文章发布失败：' + data.message;
                    message.className = 'message error';
                }
                message.style.display = 'block';
            })
            .catch(error => {
                const message = document.getElementById('post-message');
                message.textContent = '网络错误：' + error.message;
                message.className = 'message error';
                message.style.display = 'block';
            });
        });

        // 加载文章列表
        function loadPosts() {
            fetch('http://localhost:5001/api/posts')
            .then(response => response.json())
            .then(data => {
                const postsList = document.getElementById('posts-list');
                if (data.success) {
                    postsList.innerHTML = '<h3>文章列表</h3>';
                    if (data.data.length === 0) {
                        postsList.innerHTML += '<p>暂无文章</p>';
                    } else {
                        const table = document.createElement('table');
                        table.style.width = '100%';
                        table.style.borderCollapse = 'collapse';
                        table.innerHTML = `
                            <thead>
                                <tr style="background-color: #f8f9fa;">
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #dee2e6;">ID</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #dee2e6;">标题</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #dee2e6;">分类</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #dee2e6;">作者</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #dee2e6;">日期</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.map(post => `
                                    <tr>
                                        <td style="padding: 0.75rem; border: 1px solid #dee2e6;">${post.id}</td>
                                        <td style="padding: 0.75rem; border: 1px solid #dee2e6;">${post.title}</td>
                                        <td style="padding: 0.75rem; border: 1px solid #dee2e6;">${post.category}</td>
                                        <td style="padding: 0.75rem; border: 1px solid #dee2e6;">${post.author}</td>
                                        <td style="padding: 0.75rem; border: 1px solid #dee2e6;">${post.date}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        `;
                        postsList.appendChild(table);
                    }
                } else {
                    postsList.innerHTML = '<p class="error">加载文章失败：' + data.message + '</p>';
                }
            })
            .catch(error => {
                document.getElementById('posts-list').innerHTML = '<p class="error">网络错误：' + error.message + '</p>';
            });
        }
    </script>
</body>
</html>